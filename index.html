<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Storytelling Project</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="vendor/noUiSlider-12.1.0/nouislider.min.css" rel="stylesheet" />
    
    <!-- <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css"> -->
    <link
      href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
      rel="stylesheet"
      type="text/css"
    />
    <link href="vendor/clean-blog/css/clean-blog.min.css" rel="stylesheet" />

    <!-- Story CSS files -->
    <link href="story.css" rel="stylesheet" />
    <link href="mentions-bar-chart.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Page Header -->
    <header class="masthead top-background">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="post-heading">
              <h1>News Progagation During the 2018 Brazilian Presidential Elections</h1>
              <h2 class="subheading">
                The political debate was highly polarized and led to the victory of the candidate with highest rejection
                according to public opnion polls.
              </h2>
              <span class="meta">Elaborated by Aécio Santos, Anas Elghafari, and Sonia Castelo.</span>
              <span>December, 2018.</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Post Content -->
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 mx-auto main-article">
            <p>
              In 2018, Brazil had its 8<sup>th</sup> direct democratic presidential election since the end of the
              military dictatorship in 1985. It was arguably one of the most controversial elections since the beginning
              of the young Brazilian democracy. During the pre-election period, we monitored hundreds of Brazilian news
              sources and compiled a database with thousands of election-related news stories that mentioned the
              presidential candidates.
            </p>
            <div class="row no-gutters">
              <div class="col-lg-9">
                <p>
                  According to our news database, <i class="text-blue">Jair Bolsonaro</i> was by far the most popular
                  candidate in the terms of mentions mentions in article headlines. His polarizing and controversial
                  views have been described as <i>far-right</i> and conservative, drawing both praise and criticism in
                  Brazil.
                </p>
              </div>
              <div class="col-lg-3">
                <img
                  class="img-candidate mt-3"
                  title="Jair Bolsonaro. Source: Wikipedia"
                  src="images/150px-Jair_Bolsonaro.jpg"
                />
              </div>
            </div>

            <div class="row no-gutters">
              <div class="col-lg-9">
                <p>
                  The second most popular is <i>Lula</i>, the former 35<sup>th</sup> Brazilian president (2003-2011).
                  Shortly after announcing his candidacy, he was disqualified from running by the Superior Electoral
                  Court (STF) on 31 August 2018 for being previously convicted on corruption charges in a controversial
                  court ruling.
                </p>
              </div>
              <div class="col-lg-3">
                <img
                  class="img-candidate mt-4"
                  title="Luis Inácio Lula da Silva. Source: Wikipedia"
                  src="images/250px-Lula.jpg"
                />
              </div>
            </div>

            <div class="row no-gutters">
              <div class="col-lg-9">
                <p>
                  <i class="text-red">Fernando Haddad</i> was the 3<sup>rd</sup> most frequently mentioned. He was named
                  as Lula's replacement on September 1<sup>st</sup> on the Worker's Party coalition, which was
                  officially approved on <i>September 25<sup>th</sup></i
                  >. His candidacy has been criticized for its strategy of trying to inherit Lula's popularity.
                </p>
              </div>
              <div class="col-lg-3">
                <img
                  class="img-candidate mt-3"
                  title="Fernando Haddad. Source: Wikipedia"
                  src="images/150px-Fernando_Haddad.jpg"
                />
              </div>
            </div>

            <!--
              <p class="d-flex justify-content-around">
                <img
                  class="img-candidate"
                  title="Ciro Gomes. Source: Wikipedia"
                  src="images/150px-Ciro_Gomes.jpg"
                />
              </p>
            -->
            <div id="mentions-bar-chart" class="mt-5">
              <svg width="730" height="500"></svg>
              <p class="chart-caption">
                Number of presidential candidates mentions in article headlines during the pre-election period of the
                2018 Brazilian Elections.
              </p>
            </div>

            <h4 class="section-heading">What the news were talking about?</h4>
            <div id="wordcloud-news"></div>

            <h2 class="section-heading">Stories Traveled Fast</h2>

            <p>Following chart shows the speed wich news stories propagated from its original source to other sites.</p>

            <div class="chart wide-chart row no-gutters">
              <div id="propagation-speed-chart" class="col chart propagation-speed-chart"></div>
              <div class="col chart-table-container">
                <div id="google_translate_element"></div>
                <div id="top-clusters-table" class="table-responsive-sm"></div>
              </div>
            </div>

            <p>Following is the same chart with a minimum cluster size.</p>
            <div class="propagation-speed-chart" id="propagation-speed-chart-min-size"></div>

            <h2 class="section-heading">Does the popularity of candidate in the news articles reflect the election results?</h2>
            <p>
              We now move on to investigate the relation between the news coverage and mentions and the opinion polls.
              First Let us look at how the opinion polls fluctuated over the duration of the campaign.
            </p>
            <blockquote class="blockquote">
              You can filter the visualization by clicking on the icons located in the legend. To reset the visualization, please clicks on the last clicked icon.
            </blockquote>

            <div class="scatter-plot" id="scatter-plot-poll"></div>

            <p>
              Maecenas tempus, tellus eget condimentum rhoncus, sem quam semper libero, sit amet adipiscing sem neque
              sed ipsum. Nam quam nunc, blandit vel, luctus pulvinar, hendrerit id, lorem. Maecenas nec odio et ante
              tincidunt tempus. Donec vitae sapien ut libero venenatis faucibus. Nullam quis ante. Etiam sit amet orci
              eget eros faucibus tincidunt. Duis leo. Sed fringilla mauris sit amet nibh. Donec sodales sagittis magna.
            </p>

            <h2 class="section-heading">Lorem ipsum dolor sit amet</h2>

            <p>
              Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper
              nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac,
              enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus.
            </p>

            <blockquote class="blockquote">
              Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.
              Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis,
              ultricies nec, pellentesque eu, pretium.
            </blockquote>

            <p>
              Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper
              nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, eleifend ac,
              enim. Aliquam lorem ante, dapibus in, viverra quis, feugiat a, tellus.
            </p>
          </div>
        </div>
      </div>
    </article>

    <hr />

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <p class="copyright text-muted">
              Project developed for the Information Visualization (2018) course at NYU Tandon School of Engineering.
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!-- D3.js -->
    <script src="d3.js"></script>
    <script src="vendor/noUiSlider-12.1.0/nouislider.min.js"></script>
    <script src="vendor/noUiSlider-12.1.0/wNumb.js"></script>
    <script src="candidate-mentions-bar-chart.js"></script>
    <script src="propagation-speed.js"></script>
    <script src="wordcloud_news.js"></script>
    <script src="d3.layout.cloud.js"></script>
    <script src="scatterplot-poll.js"></script>
    <script>
      const csvFile = 'data/BR-elections-articles-v3.2.csv.no-exact-dups.lsh-0.6.csv';
      const TIMESTAMP_HEADER = 'timestamp';
      const DEFAULT_MIN_DATE = '2018-09-01';
      const DEFAULT_MAX_DATE = '2018-09-11';
      
      // const csvFile = 'data/BR-Crawl-Articles-Annotated.csv.Clustered.csv';
      // const TIMESTAMP_HEADER = 'crawl_timestamp'; //'article_timestamp';
      // const DEFAULT_MIN_DATE = '2018-07-01';
      // const DEFAULT_MAX_DATE = '2018-11-30';
      
      const store = {};

      function loadData() {
        return Promise.all([d3.csv(csvFile)]).then(datasets => {
          store.data = datasets[0];
          return store;
        });
      }

      function parseCsvDataTypes(data) {
        data = data.filter(d => d[TIMESTAMP_HEADER]);
        data = data.filter(d => d.domain !== 'ocafezinho.com'); // BAD data
        data.forEach(d => {
          d.cluster_id = +d.cluster_id;
          d.date = new Date(d[TIMESTAMP_HEADER]);
        });
        return data;
      }

      function filterStoriesByDate(data, min, max) {
        let minDate = new Date(min) || new Date(DEFAULT_MIN_DATE);
        let maxDate = new Date(max) || new Date(DEFAULT_MAX_DATE);
        return data.filter(d => d.date <= maxDate && d.date >= minDate);
      }

      function filterStoriesByClusterSize(clusters, min, max) {
        let minSize = typeof min === 'undefined' ? DEFAULT_MIN_CLUSTER_SIZE : min;
        let maxSize = typeof max === 'undefined' ? Number.MAX_SAFE_INTEGER : max;
        return clusters.filter(c => c.length <= maxSize && c.length >= minSize);
      }

      function groupByClusterId(data) {
        let result = {};
        data.forEach(function(d) {
          let group = result[d.cluster_id] || [];
          group.push(d);
          result[d.cluster_id] = group;
        });
        // converts the results object into an array
        result = Object.keys(result).map(key => {
          // sorts each stories cluster by date
          return result[key].sort((a, b) => d3.ascending(a.date, b.date));
        });
        // make sure clusters are sorted from largest to smallest
        result.sort((a, b) => d3.descending(a.length, b.length));
        return result;
      }

      function concatenatedHeadlines(data) {
          var badWords = [",", ":", "de", "para"];
          var text = [];
          data.forEach(function(d) {
              var temp_text = d.headline.toLowerCase().replace(/ de | para | do | e | por |:|,|;| pelo | por | na | a | o | da | é | ao | com | em | que | no | se | tem | sobre | diz /gi, "");
              text.push(temp_text);
          });
          var temp = text.filter(function(word) { return !(word in badWords) });
          var concatenated_headlines = text.join(" ");
          return concatenated_headlines;
      }

      function showData() {
        let data = store.data;
        console.log('data.length:' + data.length);

        data = parseCsvDataTypes(data);
        console.log('data.length:' + data.length);

        data = filterStoriesByDate(data, DEFAULT_MIN_DATE, DEFAULT_MAX_DATE);
        console.log('data.length:' + data.length);
        
        clusters = groupByClusterId(data);
        console.log('clusters.length:' + clusters.length);

        drawProgagationSpeedChart({
          tagId: '#propagation-speed-chart',
          data: data,
          clusters: clusters,
          min: 10,
        });

        drawProgagationSpeedChart({
          tagId: '#propagation-speed-chart-min-size',
          data: data,
          clusters: clusters,
          slider: false,
          table: false,
          min: 20,
          max: 41,
        });
        
        // var data_words =  "How the Word Cloud Generator Works\n";
        renderWordCloud('#wordcloud-news', concatenatedHeadlines(data));
      }

      loadData().then(showData);
    </script>

    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({ pageLanguage: 'pt' }, 'google_translate_element');
      }
    </script>
    <script
      type="text/javascript"
      src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
    ></script>
  </body>
</html>
